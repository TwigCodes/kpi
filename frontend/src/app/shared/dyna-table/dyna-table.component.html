<table mat-table matSort [dataSource]="ds" [matSortDisabled]="!sortable" (matSortChange)="handleSortChange($event)">
  <ng-container matColumnDef="select" *ngIf="selectable">
    <th mat-header-cell *matHeaderCellDef>
      <mat-checkbox [checked]="selection.hasValue() && isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()"
        (change)="$event ? masterToggle() : undefined">
      </mat-checkbox>
    </th>
    <td mat-cell *matCellDef="let row">
      <mat-checkbox [checked]="selection.isSelected(row)" (click)="$event.stopPropagation()" (change)="handleSelectChange($event, row)">
      </mat-checkbox>
    </td>
  </ng-container>
  <!-- Generic column definition -->
  <ng-container *ngFor="let column of columns;let idx = index;">
    <ng-container
      [matColumnDef]="column.field.name"
      [sticky]="column.sticky === 'start'"
      [stickyEnd]="column.sticky === 'end'">
      <th mat-header-cell *matHeaderCellDef>
        <ng-container *ngIf="filterable">
          <button mat-icon-button [matMenuTriggerFor]="menu.filterMenu">
            <mat-icon> keyboard_arrow_down </mat-icon>
          </button>
          <ngx-filter-menu
            #menu
            [filterField]="column.field"
            [operators]="column.filterOperators"
            (filterAdd)="handleFilterAdd($event)"
            (filterRemove)="handleFilterRemove($event)"
            (filterClear)="handleFilterClear($event)">
          </ngx-filter-menu>
        </ng-container>
        <span *ngIf="sortable else nosort" mat-sort-header arrowPosition="after">
          {{ column.field.label }}
        </span>
        <ng-template #nosort>
          <span>{{ column.field.label }} </span>
        </ng-template>
      </th>
      <td mat-cell *matCellDef="let row" [ngClass]="styleMatrix(column)" [ngSwitch]="column.display">
        <ng-container *ngSwitchCase="1">
          <mat-icon *ngIf="column.cell(row) else clear" class="checked">done</mat-icon>
          <ng-template #clear>
            <mat-icon class="unchecked">clear</mat-icon>
          </ng-template>
        </ng-container>
        <span *ngSwitchCase="2">{{ !row ? '' : column.cell(row) | date:'yyyy-MM-dd' : '+0800' }}</span>
        <span *ngSwitchCase="4">
          <mat-icon [svgIcon]="'json'"></mat-icon>
        </span>
        <span *ngSwitchCase="5">
          <a [routerLink]="column.cell(row)">{{ column.field.label }}</a>
        </span>
        <ng-container *ngSwitchDefault>{{ column.cell(row) }}</ng-container>
      </td>
    </ng-container>
  </ng-container>
  <ng-container *ngIf="headerSticky else noHeaderSticky">
    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
  </ng-container>
  <ng-template #noHeaderSticky>
    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
  </ng-template>
  <tr mat-row *matRowDef="let row; columns: displayedColumns; let index = index;" [ngClass]="{'row-highlight': isHighlight && selectedIndex === index}"
    [cdkDetailRow]="row" [cdkDetailRowTpl]="tpl" [@rowsAnimation]="" (mouseenter)="toggleHighlight(true, index)"
    (mouseleave)="toggleHighlight(false, index)" (click)="emitClick(row)">
  </tr>
</table>
<mat-paginator #paginator (page)="emitPage($event)" [showFirstLastButtons]="true" [pageIndex]="pageIndex" [length]="total"
  [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions">
</mat-paginator>
